# Progressive Canary Deployment with Argo Rollouts

## 📘 Overview

This document provides step-by-step guidance for performing **Progressive Canary Deployments** using **Argo Rollouts**.  
You’ll learn how to promote a rollout using both **CLI** and the **Web UI Dashboard**, and how to verify the rollout behavior through the demo web application.

---

## 🧩 Prerequisites

Before starting, ensure the following are completed:

- Argo Rollouts Controller is installed and running in your Kubernetes cluster.  
- `kubectl argo rollouts` plugin is installed.  
- Argo Rollouts Dashboard is deployed and accessible via:  
  **http://argorollouts.apsis.localnet**
- Demo Rollout, Service, and Ingress are already applied and accessible via:  
  **http://demorollouts.apsis.localnet**

---

## 🚀 Step 1: Verify the Current Rollout Status

```bash
kubectl argo rollouts list rollouts
```

Example output:

```
NAME           STRATEGY   STATUS        STEP  SET-WEIGHT  READY  DESIRED  UP-TO-DATE  AVAILABLE
rollouts-demo  Canary     Healthy       8/8   100         5/5    5        5           5
```

To get detailed rollout information:

```bash
kubectl argo rollouts get rollout rollouts-demo
```

---

## 🧭 Step 2: Trigger an Update (Blue → Green)

Edit the image version in the rollout manifest:

```bash
kubectl argo rollouts set image rollouts-demo rollouts-demo=argoproj/rollouts-demo:green
```

Watch the rollout progress:

```bash
kubectl argo rollouts get rollout rollouts-demo --watch
```

The rollout will pause automatically at each defined step based on your `canary` configuration.

Example Output: 

```
Name:            rollouts-demo
Namespace:       default
Status:          ॥ Paused
Message:         CanaryPauseStep
Strategy:        Canary
  Step:          1/8
  SetWeight:     20
  ActualWeight:  20
Images:          argoproj/rollouts-demo:blue (stable)
                 argoproj/rollouts-demo:green (canary)
Replicas:
  Desired:       5
  Current:       5
  Updated:       1
  Ready:         5
  Available:     5

NAME                                       KIND        STATUS     AGE   INFO
⟳ rollouts-demo                            Rollout     ॥ Paused   105m
├──# revision:2
│  └──⧉ rollouts-demo-7d9c645dbb           ReplicaSet  ✔ Healthy  24s   canary
│     └──□ rollouts-demo-7d9c645dbb-hdsg6  Pod         ✔ Running  24s   ready:1/1
└──# revision:1
   └──⧉ rollouts-demo-687d76d795           ReplicaSet  ✔ Healthy  105m  stable
      ├──□ rollouts-demo-687d76d795-2vcgd  Pod         ✔ Running  105m  ready:1/1
      ├──□ rollouts-demo-687d76d795-9bmf2  Pod         ✔ Running  105m  ready:1/1
      ├──□ rollouts-demo-687d76d795-zbj5l  Pod         ✔ Running  105m  ready:1/1
      └──□ rollouts-demo-687d76d795-zk48c  Pod         ✔ Running  105m  ready:1/1
```
On Argo Rollouts UI: 
<img width="1652" height="687" alt="image" src="https://github.com/user-attachments/assets/64308658-e396-4f19-9ce7-41f4a0e404eb" />

On App UI: 
<img width="1646" height="673" alt="image" src="https://github.com/user-attachments/assets/c0f81769-587f-41d5-b1a8-88d9c6d1f639" />

---

## 🧑‍💻 Step 3: Promote Canary via Command Line

When the rollout is paused, promote it manually:

```bash
kubectl argo rollouts promote rollouts-demo
```

You will see output indicating the rollout has advanced to the next step, for example:

```
rollout 'rollouts-demo' promoted successfully
```

### ✅ Verify the Promotion

Run:

```bash
kubectl argo rollouts get rollout rollouts-demo
```

Then, open **http://demorollouts.apsis.localnet** in your browser to confirm the **new (green)** version is being served.

You may attach screenshots of:
- CLI rollout status (`kubectl argo rollouts get rollout rollouts-demo`)
- Web app output showing the updated version.

---

## 🖥️ Step 4: Promote Canary via Argo Rollouts Dashboard

1. Access **http://argorollouts.apsis.localnet**
2. Select the **rollouts-demo** rollout from the list.
3. Click **Promote** to proceed to the next canary step.

The UI will update in real time, reflecting the progress of the canary deployment.

### ✅ Verify the UI Promotion

After promotion:
- Visit **http://demorollouts.apsis.localnet**
- Confirm the version reflects the **new green** deployment.

Attach screenshots of:
- Dashboard promotion confirmation.
- Updated web application output.

---

## 🔍 Step 5: Monitor Rollout to Completion

Continue promoting the rollout until all steps are completed and status shows **✔ Healthy** with **SetWeight: 100**.

```bash
kubectl argo rollouts get rollout rollouts-demo
```

Example output:

```
Name:            rollouts-demo
Namespace:       default
Status:          ✔ Healthy
Strategy:        Canary
  Step:          8/8
  SetWeight:     100
  ActualWeight:  100
Images:          argoproj/rollouts-demo:green (stable)
Replicas:
  Desired:       5
  Current:       5
  Updated:       5
  Ready:         5
  Available:     5
```

---

## 🏁 Step 6: Validation

Visit **http://demorollouts.apsis.localnet** and verify that:
- The application is now running the **green** version.
- The rollout status in CLI and Dashboard are both **Healthy**.

---

## 📄 Summary

| Action | Method | Verification |
|--------|---------|--------------|
| Promote Canary | CLI | `kubectl argo rollouts get rollout rollouts-demo` |
| Promote Canary | Web UI | Argo Rollouts Dashboard |
| Verify Output | Browser | http://demorollouts.apsis.localnet |
| Monitor Rollout | CLI | `kubectl argo rollouts get rollout rollouts-demo --watch` |

---

**Document Date:** October 10, 2025  
**Author:** Jamal Hossain  
**Tool:** Argo Rollouts  
**Version:** v1.0

